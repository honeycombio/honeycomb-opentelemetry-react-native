# Troubleshooting Guide

This guide covers common issues you might encounter when using the Honeycomb OpenTelemetry React Native SDK.

## Missing Device or OS Attributes

**Problem**: Some device or OS attributes (like `device.id`, `device.manufacturer`, `os.description`) are not appearing in your telemetry.

**Solution**: These attributes require native SDK configuration. Configure the native SDKs for iOS and Android as described in the [Native Configuration](README.md#native-configuration) section of the README. Without native configuration, you'll still get JavaScript-level telemetry with basic attributes like `os.name` and `os.version`.

## Custom Span Processors Not Affecting Native Spans

**Problem**: Custom span processors passed to the SDK configuration are not modifying spans generated by the native SDKs.

**Explanation**: Custom span processors configured in JavaScript only apply to JavaScript-generated spans. Native spans are processed by the native SDKs independently.

**Solution**: If you need to modify native spans, configure span processors directly in the native SDK initialization code for iOS and Android.

## Metro Bundler Configuration Issues

**Problem**: Build errors related to package resolution or module imports.

**Solution**: Ensure your [metro.config.js](example/metro.config.js) has `config.resolver.unstable_enablePackageExports` enabled:

```javascript
const config = {
  resolver: {
    unstable_enablePackageExports: true,
  },
  // ... rest of your config
};
```

This is required for OpenTelemetry packages to properly resolve their dependencies.

## iOS Build Errors with Cocoapods

**Problem**: Build errors after adding the Honeycomb SDK on iOS.

**Solution**:

1. Ensure `use_frameworks!` is added to your `ios/Podfile`:
   ```ruby
   use_frameworks!
   ```

2. Clean your Cocoapods installation and reinstall:
   ```sh
   cd ios
   rm -rf Pods Podfile.lock
   pod install
   cd ..
   ```

3. Clean your Xcode build folder (in Xcode: Product â†’ Clean Build Folder)

## Android Build Errors with Min SDK < 26

**Problem**: Build errors on Android when your `minSdkVersion` is below 26.

**Solution**: Enable core library desugaring in your `android/app/build.gradle`:

```kotlin
android {
  compileOptions {
    coreLibraryDesugaringEnabled true
  }

  dependencies {
    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:2.1.5"
  }
}
```

## No Telemetry Data Appearing in Honeycomb

**Problem**: You've configured the SDK but no data is appearing in Honeycomb.

**Checklist**:

1. **Verify your API key**: Ensure your API key is correct and has write permissions
2. **Check the service name**: Look for your service in the Honeycomb dataset dropdown
3. **Verify SDK initialization**: Ensure `sdk.start()` is called
4. **Check network connectivity**: Verify your app can reach `https://api.honeycomb.io`
5. **Look for errors**: Check your console for any error messages from the SDK
6. **Verify you're generating telemetry**: Try creating a test span to verify the SDK is working:
   ```typescript
   import { trace } from '@opentelemetry/api';

   const span = trace.getTracer('test').startSpan('test-span');
   span.end();
   ```

## Fetch Instrumentation Not Working

**Problem**: HTTP requests made with `fetch` are not being traced.

**Solution**:

1. Ensure fetch instrumentation is enabled (it's enabled by default):
   ```typescript
   const sdk = new HoneycombReactNativeSDK({
     apiKey: 'YOUR-API-KEY',
     serviceName: 'your-app',
     fetchInstrumentationConfig: {
       enabled: true,
     },
   });
   ```

2. For distributed tracing (propagating trace context to your backend), configure CORS URLs:
   ```typescript
   fetchInstrumentationConfig: {
     enabled: true,
     propagateTraceHeaderCorsUrls: [
       /https:\/\/api\.yourbackend\.com\/.*/,
     ]
   }
   ```

## Navigation Instrumentation Not Working

**Problem**: Navigation events are not being tracked.

**Solution**:

1. Ensure you're using the `NavigationInstrumentation` component
2. Verify the navigation ref is properly passed to the component
3. For React Navigation, ensure the component is a child of `NavigationContainer`
4. For Expo Router, ensure you're using the ref from `useNavigationContainerRef` from `expo-router`

Example for Expo Router:
```tsx
import { NavigationInstrumentation } from '@honeycombio/opentelemetry-react-native';
import { useNavigationContainerRef } from 'expo-router';

export default function RootLayout() {
  const navigationRef = useNavigationContainerRef();

  return (
    <NavigationInstrumentation ref={navigationRef}>
      {/* Your app content */}
    </NavigationInstrumentation>
  );
}
```

## Slow Event Loop Detection Too Sensitive

**Problem**: Getting too many "slow event loop" spans for normal operations.

**Solution**: Adjust the threshold and sample interval:

```typescript
const sdk = new HoneycombReactNativeSDK({
  apiKey: 'YOUR-API-KEY',
  serviceName: 'your-app',
  slowEventLoopInstrumentationConfig: {
    enabled: true,
    loopSampleIntervalMs: 100,  // Increase from default 50ms
    stallThresholdMs: 100,       // Increase from default 50ms
  },
});
```

Or disable it entirely:
```typescript
slowEventLoopInstrumentationConfig: {
  enabled: false,
}
```

## TypeScript Type Errors

**Problem**: TypeScript errors when using the SDK.

**Solution**: Ensure you have the necessary type definitions installed:

```sh
yarn add --dev @types/react @opentelemetry/api
```

## Still Having Issues?

If you're still experiencing problems:

1. Check the [GitHub Issues](https://github.com/honeycombio/honeycomb-opentelemetry-react-native/issues) for similar problems
2. Review the [Honeycomb Documentation](https://docs.honeycomb.io/get-started/start-building/application/react-native/)
3. Open a new issue with:
   - Your SDK version
   - React Native version
   - Platform (iOS/Android)
   - Steps to reproduce the issue
   - Any error messages or logs
